#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã JXCT
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, ThingSpeak –∏ –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
"""

import json
import os
import sys

def check_config_file():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"""
    config_path = "platformio.ini"
    if not os.path.exists(config_path):
        print("‚ùå –§–∞–π–ª platformio.ini –Ω–µ –Ω–∞–π–¥–µ–Ω")
        return False
    
    print("‚úÖ –§–∞–π–ª platformio.ini –Ω–∞–π–¥–µ–Ω")
    return True

def check_source_files():
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤"""
    files_to_check = [
        "src/main.cpp",
        "src/advanced_filters.cpp",
        "src/thingspeak_client.cpp",
        "src/config.cpp"
    ]
    
    missing_files = []
    for file_path in files_to_check:
        if not os.path.exists(file_path):
            missing_files.append(file_path)
    
    if missing_files:
        print(f"‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ñ–∞–π–ª—ã: {missing_files}")
        return False
    
    print("‚úÖ –í—Å–µ –∫–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã –Ω–∞–π–¥–µ–Ω—ã")
    return True

def analyze_advanced_filters():
    """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏"""
    print("\nüîç –ê–ù–ê–õ–ò–ó –§–ò–õ–¨–¢–†–ê–¶–ò–ò:")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    default_settings = {
        "adaptiveFiltering": 0,  # –æ—Ç–∫–ª—é—á–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        "kalmanEnabled": 0,      # –æ—Ç–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        "outlierFilterEnabled": 0  # –æ—Ç–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    }
    
    print(f"   ‚Ä¢ –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è: {'–í–ö–õ–Æ–ß–ï–ù–ê' if default_settings['adaptiveFiltering'] else '–û–¢–ö–õ–Æ–ß–ï–ù–ê'} (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)")
    print(f"   ‚Ä¢ –§–∏–ª—å—Ç—Ä –ö–∞–ª–º–∞–Ω–∞: {'–í–ö–õ–Æ–ß–ï–ù' if default_settings['kalmanEnabled'] else '–û–¢–ö–õ–Æ–ß–ï–ù'} (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)")
    print(f"   ‚Ä¢ –§–∏–ª—å—Ç—Ä –≤—ã–±—Ä–æ—Å–æ–≤: {'–í–ö–õ–Æ–ß–ï–ù' if default_settings['outlierFilterEnabled'] else '–û–¢–ö–õ–Æ–ß–ï–ù'} (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)")
    
    print("\n   üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –§–ò–õ–¨–¢–†–û–í:")
    print("   ‚Ä¢ –ï—Å–ª–∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ –≤—ã–≤–æ–¥–∏—Ç—Å—è")
    print("   ‚Ä¢ –î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è: –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ config.adaptiveFiltering = 1")
    
    return True

def analyze_thingspeak():
    """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ThingSpeak"""
    print("\nüîç –ê–ù–ê–õ–ò–ó THINGSPEAK:")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    default_settings = {
        "thingSpeakEnabled": False,  # –æ—Ç–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        "thingSpeakInterval": 60000,  # 1 –º–∏–Ω—É—Ç–∞
        "thingSpeakApiKey": "",      # –ø—É—Å—Ç–æ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        "thingSpeakChannelId": ""    # –ø—É—Å—Ç–æ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    }
    
    print(f"   ‚Ä¢ ThingSpeak: {'–í–ö–õ–Æ–ß–ï–ù' if default_settings['thingSpeakEnabled'] else '–û–¢–ö–õ–Æ–ß–ï–ù'} (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)")
    print(f"   ‚Ä¢ –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏: {default_settings['thingSpeakInterval']/1000} —Å–µ–∫—É–Ω–¥")
    print(f"   ‚Ä¢ API –∫–ª—é—á: {'–ù–ê–°–¢–†–û–ï–ù' if default_settings['thingSpeakApiKey'] else '–ù–ï –ù–ê–°–¢–†–û–ï–ù'}")
    print(f"   ‚Ä¢ Channel ID: {'–ù–ê–°–¢–†–û–ï–ù' if default_settings['thingSpeakChannelId'] else '–ù–ï –ù–ê–°–¢–†–û–ï–ù'}")
    
    print("\n   üìä –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê:")
    print("   ‚Ä¢ –î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è: –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å")
    print("   ‚Ä¢ –¢—Ä–µ–±—É–µ—Ç—Å—è API –∫–ª—é—á –∏ Channel ID")
    print("   ‚Ä¢ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–Ω–∞—á–∏–º—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö")
    
    return True

def analyze_mqtt():
    """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ MQTT"""
    print("\nüîç –ê–ù–ê–õ–ò–ó MQTT:")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    default_settings = {
        "mqttEnabled": False,        # –æ—Ç–∫–ª—é—á–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        "mqttPublishInterval": 30000,  # 30 —Å–µ–∫—É–Ω–¥
        "mqttServer": "",            # –ø—É—Å—Ç–æ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        "mqttUser": "",              # –ø—É—Å—Ç–æ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        "mqttPassword": ""           # –ø—É—Å—Ç–æ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    }
    
    print(f"   ‚Ä¢ MQTT: {'–í–ö–õ–Æ–ß–ï–ù' if default_settings['mqttEnabled'] else '–û–¢–ö–õ–Æ–ß–ï–ù'} (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)")
    print(f"   ‚Ä¢ –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—É–±–ª–∏–∫–∞—Ü–∏–∏: {default_settings['mqttPublishInterval']/1000} —Å–µ–∫—É–Ω–¥")
    print(f"   ‚Ä¢ –°–µ—Ä–≤–µ—Ä: {'–ù–ê–°–¢–†–û–ï–ù' if default_settings['mqttServer'] else '–ù–ï –ù–ê–°–¢–†–û–ï–ù'}")
    
    print("\n   üìä –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê:")
    print("   ‚Ä¢ –î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è: –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å")
    print("   ‚Ä¢ –¢—Ä–µ–±—É–µ—Ç—Å—è MQTT —Å–µ—Ä–≤–µ—Ä –∏ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ")
    print("   ‚Ä¢ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö (–¥–µ–ª—å—Ç–∞-—Ñ–∏–ª—å—Ç—Ä)")
    
    return True

def check_preferences_error():
    """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–∫–∏ Preferences"""
    print("\nüîç –ê–ù–ê–õ–ò–ó –û–®–ò–ë–ö–ò PREFERENCES:")
    
    print("   ‚Ä¢ –û—à–∏–±–∫–∞: [E][Preferences.cpp:503] getBytesLength(): nvs")
    print("   ‚Ä¢ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:")
    print("     - –ü—Ä–æ–±–ª–µ–º–∞ —Å NVS (Non-Volatile Storage)")
    print("     - –ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏")
    print("     - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –≤ NVS")
    
    print("\n   üìä –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:")
    print("   ‚Ä¢ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å")
    print("   ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –≤ –ø–∞–º—è—Ç–∏ ESP32")
    print("   ‚Ä¢ –û—à–∏–±–∫–∞ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞, –µ—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ")
    
    return True

def generate_recommendations():
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ"""
    print("\nüéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:")
    
    print("1. üìä –§–ò–õ–¨–¢–†–ê–¶–ò–Ø:")
    print("   ‚Ä¢ –í–∫–ª—é—á–∏—Ç–µ –∞–¥–∞–ø—Ç–∏–≤–Ω—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏")
    print("   ‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚Üí –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è")
    
    print("\n2. üåê THINGSPEAK:")
    print("   ‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ API –∫–ª—é—á –∏ Channel ID —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å")
    print("   ‚Ä¢ –í–∫–ª—é—á–∏—Ç–µ ThingSpeak –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö")
    print("   ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 60 —Å–µ–∫—É–Ω–¥)")
    
    print("\n3. üì° MQTT:")
    print("   ‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ MQTT —Å–µ—Ä–≤–µ—Ä –∏ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ")
    print("   ‚Ä¢ –í–∫–ª—é—á–∏—Ç–µ MQTT –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö")
    print("   ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—É–±–ª–∏–∫–∞—Ü–∏–∏")
    
    print("\n4. üîß –û–®–ò–ë–ö–ò:")
    print("   ‚Ä¢ –û—à–∏–±–∫–∞ Preferences –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞")
    print("   ‚Ä¢ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ")
    print("   ‚Ä¢ –ú–æ–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å, –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å —Ä–∞–±–æ—Ç–æ–π")
    
    return True

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏"""
    print("üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –°–ò–°–¢–ï–ú–´ JXCT")
    print("=" * 50)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª—ã
    if not check_config_file():
        return 1
    
    if not check_source_files():
        return 1
    
    # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    analyze_advanced_filters()
    analyze_thingspeak()
    analyze_mqtt()
    check_preferences_error()
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    generate_recommendations()
    
    print("\n‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞")
    return 0

if __name__ == "__main__":
    sys.exit(main()) 