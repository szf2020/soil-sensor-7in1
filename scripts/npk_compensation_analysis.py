#!/usr/bin/env python3
"""
–ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ä–º—É–ª –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ NPK
–û–±—ä—è—Å–Ω—è–µ—Ç, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –¥–∞—Ç—á–∏–∫–∞ –≤ —Ñ–æ—Ä–º—É–ª–∞—Ö –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏
"""

def analyze_npk_compensation_formulas():
    """–ê–Ω–∞–ª–∏–∑ —Ñ–æ—Ä–º—É–ª NPK –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö"""
    
    print("üî¨ –ê–ù–ê–õ–ò–ó –§–û–†–ú–£–õ NPK –ö–û–ú–ü–ï–ù–°–ê–¶–ò–ò")
    print("=" * 60)
    
    print("\nüìä –ò–°–ü–û–õ–¨–ó–£–ï–ú–´–ï –î–ê–ù–ù–´–ï –í –§–û–†–ú–£–õ–ê–• NPK:")
    print("-" * 50)
    
    print("""
‚úÖ –°–´–†–´–ï –î–ê–ù–ù–´–ï –° –î–ê–¢–ß–ò–ö–ê (–ò–°–ü–û–õ–¨–ó–£–Æ–¢–°–Ø –í –§–û–†–ú–£–õ–ê–•):

1. üß™ NPK –°–´–†–´–ï –ó–ù–ê–ß–ï–ù–ò–Ø:
   ‚Ä¢ N_raw = sensorData.nitrogen (–º–≥/–∫–≥)
   ‚Ä¢ P_raw = sensorData.phosphorus (–º–≥/–∫–≥) 
   ‚Ä¢ K_raw = sensorData.potassium (–º–≥/–∫–≥)
   ‚Ä¢ –ò—Å—Ç–æ—á–Ω–∏–∫: Modbus —Ä–µ–≥–∏—Å—Ç—Ä—ã –¥–∞—Ç—á–∏–∫–∞ JXCT 7-–≤-1

2. üå°Ô∏è –¢–ï–ú–ü–ï–†–ê–¢–£–†–ê:
   ‚Ä¢ T = sensorData.temperature (¬∞C)
   ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω–æ–π –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏
   ‚Ä¢ –ë–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: 20¬∞C

3. üíß –í–õ–ê–ñ–ù–û–°–¢–¨:
   ‚Ä¢ Œ∏ = sensorData.humidity (%)
   ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–ª–∞–∂–Ω–æ—Å—Ç–Ω–æ–π –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏
   ‚Ä¢ –ë–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: 30%

4. üåç –¢–ò–ü –ü–û–ß–í–´:
   ‚Ä¢ –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã Œ¥ –∏ Œµ
   ‚Ä¢ –í–ª–∏—è–µ—Ç –Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç—å –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏
""")
    
    print("\nüßÆ –ù–ê–£–ß–ù–´–ï –§–û–†–ú–£–õ–´ NPK –ö–û–ú–ü–ï–ù–°–ê–¶–ò–ò:")
    print("-" * 50)
    
    print("""
üìê –§–û–†–ú–£–õ–´ (Delgado et al., 2020):

N_comp = N_raw √ó e^(Œ¥N(T-20)) √ó (1 + ŒµN(Œ∏-30))
P_comp = P_raw √ó e^(Œ¥P(T-20)) √ó (1 + ŒµP(Œ∏-30))  
K_comp = K_raw √ó e^(Œ¥K(T-20)) √ó (1 + ŒµK(Œ∏-30))

–ì–¥–µ:
‚Ä¢ N_raw, P_raw, K_raw - –°–´–†–´–ï –¥–∞–Ω–Ω—ã–µ —Å –¥–∞—Ç—á–∏–∫–∞
‚Ä¢ T - —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C)
‚Ä¢ Œ∏ - –≤–ª–∞–∂–Ω–æ—Å—Ç—å (%)
‚Ä¢ Œ¥N, Œ¥P, Œ¥K - —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
‚Ä¢ ŒµN, ŒµP, ŒµK - –≤–ª–∞–∂–Ω–æ—Å—Ç–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
""")
    
    print("\nüîß –ö–û–≠–§–§–ò–¶–ò–ï–ù–¢–´ –ü–û –¢–ò–ü–ê–ú –ü–û–ß–í:")
    print("-" * 50)
    
    coefficients = {
        "–ü–µ—Å–æ–∫": {"Œ¥N": 0.0041, "Œ¥P": 0.0053, "Œ¥K": 0.0032, "ŒµN": 0.010, "ŒµP": 0.008, "ŒµK": 0.012},
        "–°—É–≥–ª–∏–Ω–æ–∫": {"Œ¥N": 0.0045, "Œ¥P": 0.0057, "Œ¥K": 0.0036, "ŒµN": 0.012, "ŒµP": 0.010, "ŒµK": 0.014},
        "–ì–ª–∏–Ω–∞": {"Œ¥N": 0.0050, "Œ¥P": 0.0062, "Œ¥K": 0.0040, "ŒµN": 0.015, "ŒµP": 0.012, "ŒµK": 0.016},
        "–¢–æ—Ä—Ñ": {"Œ¥N": 0.0038, "Œ¥P": 0.0048, "Œ¥K": 0.0028, "ŒµN": 0.008, "ŒµP": 0.006, "ŒµK": 0.010}
    }
    
    for soil_type, coeffs in coefficients.items():
        print(f"\n{soil_type}:")
        print(f"  Œ¥N={coeffs['Œ¥N']:.4f}, Œ¥P={coeffs['Œ¥P']:.4f}, Œ¥K={coeffs['Œ¥K']:.4f}")
        print(f"  ŒµN={coeffs['ŒµN']:.3f}, ŒµP={coeffs['ŒµP']:.3f}, ŒµK={coeffs['ŒµK']:.3f}")
    
    print("\nüíª –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø –í –ö–û–î–ï:")
    print("-" * 50)
    
    print("""
üîç –ö–õ–Æ–ß–ï–í–´–ï –ú–û–ú–ï–ù–¢–´ –í –ö–û–î–ï:

1. üì• –ü–û–õ–£–ß–ï–ù–ò–ï –°–´–†–´–• –î–ê–ù–ù–´–•:
   ```cpp
   // –í modbus_sensor.cpp - —á—Ç–µ–Ω–∏–µ —Å –¥–∞—Ç—á–∏–∫–∞
   readSingleRegister(REG_NITROGEN, "–ê–∑–æ—Ç", 1.0F, &sensorData.nitrogen, true)
   readSingleRegister(REG_PHOSPHORUS, "–§–æ—Å—Ñ–æ—Ä", 1.0F, &sensorData.phosphorus, true)
   readSingleRegister(REG_POTASSIUM, "–ö–∞–ª–∏–π", 1.0F, &sensorData.potassium, true)
   ```

2. üîÑ –ü–ï–†–ï–î–ê–ß–ê –í –ö–û–ú–ü–ï–ù–°–ê–¶–ò–Æ:
   ```cpp
   // –í sensor_processing.cpp
   NPKReferences npk{sensorData.nitrogen, sensorData.phosphorus, sensorData.potassium};
   gCompensationService.correctNPK(sensorData.temperature, sensorData.humidity, soil, npk);
   ```

3. üßÆ –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –§–û–†–ú–£–õ:
   ```cpp
   // –í sensor_compensation_service.cpp
   // –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è: e^(Œ¥(T-20))
   const float tempFactorN = exp(coeffs.delta_N * (temperature - 20.0F));
   
   // –í–ª–∞–∂–Ω–æ—Å—Ç–Ω–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è: (1 + Œµ(Œ∏-30))
   const float moistureFactorN = 1.0F + (coeffs.epsilon_N * (humidity - 30.0F));
   
   // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—é: N_comp = N_raw √ó tempFactor √ó moistureFactor
   npk.nitrogen *= (tempFactorN * moistureFactorN);
   ```

4. üíæ –°–û–•–†–ê–ù–ï–ù–ò–ï –†–ï–ó–£–õ–¨–¢–ê–¢–ê:
   ```cpp
   // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ sensorData
   sensorData.nitrogen = npk.nitrogen;
   sensorData.phosphorus = npk.phosphorus;
   sensorData.potassium = npk.potassium;
   ```
""")
    
    print("\nüìä –ü–†–ò–ú–ï–† –†–ê–°–ß–ï–¢–ê:")
    print("-" * 50)
    
    # –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞
    print("""
üéØ –ü–†–ò–ú–ï–†: –°—É–≥–ª–∏–Ω–æ–∫, T=25¬∞C, Œ∏=40%, N_raw=150 –º–≥/–∫–≥

–†–∞—Å—á–µ—Ç:
1. –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è:
   tempFactorN = e^(0.0045 √ó (25-20)) = e^(0.0045 √ó 5) = e^0.0225 = 1.0228

2. –í–ª–∞–∂–Ω–æ—Å—Ç–Ω–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è:
   moistureFactorN = 1 + 0.012 √ó (40-30) = 1 + 0.012 √ó 10 = 1.120

3. –ò—Ç–æ–≥–æ–≤–∞—è –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è:
   N_comp = 150 √ó 1.0228 √ó 1.120 = 171.8 –º–≥/–∫–≥

–†–µ–∑—É–ª—å—Ç–∞—Ç: N_raw=150 ‚Üí N_comp=171.8 (—É–≤–µ–ª–∏—á–µ–Ω–∏–µ –Ω–∞ 14.5%)
""")
    
    print("\n‚úÖ –û–¢–í–ï–¢ –ù–ê –í–û–ü–†–û–°:")
    print("-" * 50)
    
    print("""
üéØ –î–ê, –í –§–û–†–ú–£–õ–ê–• NPK –ö–û–ú–ü–ï–ù–°–ê–¶–ò–ò –ò–°–ü–û–õ–¨–ó–£–Æ–¢–°–Ø –°–´–†–´–ï –î–ê–ù–ù–´–ï –° –î–ê–¢–ß–ò–ö–ê!

üîç –ö–ê–ö –≠–¢–û –†–ê–ë–û–¢–ê–ï–¢:

1. üì° –î–ê–¢–ß–ò–ö ‚Üí –°–´–†–´–ï –î–ê–ù–ù–´–ï:
   ‚Ä¢ JXCT 7-–≤-1 —Å—á–∏—Ç—ã–≤–∞–µ—Ç NPK —á–µ—Ä–µ–∑ Modbus RTU
   ‚Ä¢ –ü–æ–ª—É—á–∞–µ–º N_raw, P_raw, K_raw –≤ –º–≥/–∫–≥
   ‚Ä¢ –≠—Ç–æ –ù–ï –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

2. üßÆ –§–û–†–ú–£–õ–ê –ö–û–ú–ü–ï–ù–°–ê–¶–ò–ò:
   ‚Ä¢ N_comp = N_raw √ó —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–π_—Ñ–∞–∫—Ç–æ—Ä √ó –≤–ª–∞–∂–Ω–æ—Å—Ç–Ω—ã–π_—Ñ–∞–∫—Ç–æ—Ä
   ‚Ä¢ P_comp = P_raw √ó —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–π_—Ñ–∞–∫—Ç–æ—Ä √ó –≤–ª–∞–∂–Ω–æ—Å—Ç–Ω—ã–π_—Ñ–∞–∫—Ç–æ—Ä
   ‚Ä¢ K_comp = K_raw √ó —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–π_—Ñ–∞–∫—Ç–æ—Ä √ó –≤–ª–∞–∂–Ω–æ—Å—Ç–Ω—ã–π_—Ñ–∞–∫—Ç–æ—Ä

3. üìä –†–ï–ó–£–õ–¨–¢–ê–¢:
   ‚Ä¢ –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí –ù–∞—É—á–Ω–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
   ‚Ä¢ –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –≤–ª–∞–∂–Ω–æ—Å—Ç—å, —Ç–∏–ø –ø–æ—á–≤—ã
   ‚Ä¢ –ü–æ–≤—ã—à–∞–µ—Ç—Å—è —Ç–æ—á–Ω–æ—Å—Ç—å –∏–∑–º–µ—Ä–µ–Ω–∏–π

4. üî¨ –ù–ê–£–ß–ù–ê–Ø –û–°–ù–û–í–ê:
   ‚Ä¢ –ò—Å—Ç–æ—á–Ω–∏–∫: Delgado et al. (2020)
   ‚Ä¢ DOI: 10.1007/s42729-020-00215-4
   ‚Ä¢ European Journal of Soil Science

üí° –í–´–í–û–î:
–§–æ—Ä–º—É–ª—ã NPK –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏ –ü–†–ê–í–ò–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –¥–∞—Ç—á–∏–∫–∞
–∫–∞–∫ –æ—Å–Ω–æ–≤—É –¥–ª—è –Ω–∞—É—á–Ω–æ–π –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ —Å —É—á–µ—Ç–æ–º –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤.
""")

if __name__ == "__main__":
    analyze_npk_compensation_formulas()
