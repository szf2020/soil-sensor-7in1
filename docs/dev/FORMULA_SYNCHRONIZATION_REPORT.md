# üî¨ –û—Ç—á–µ—Ç –æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ñ–æ—Ä–º—É–ª –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏–∏

**–î–∞—Ç–∞:** 11.07.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–ï–®–ï–ù–û  
**–ü—Ä–æ–±–ª–µ–º–∞:** –†–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —Ñ–æ—Ä–º—É–ª –≤ –∫–æ–¥–µ, —Ç–µ—Å—Ç–∞—Ö –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏  

---

## üö® –ü–†–û–ë–õ–ï–ú–ê

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ –∑–∞–º–µ—Ç–∏–ª, —á—Ç–æ –º—ã **10 —Ä–∞–∑ –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏—Å—å –∫ —Ñ–æ—Ä–º—É–ª–∞–º** –∏ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –Ω–∞—Ö–æ–¥–∏–ª–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è. –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –∏–∑-–∑–∞ **–†–ê–ó–ù–´–• –í–ï–†–°–ò–ô** —Ñ–æ—Ä–º—É–ª –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç—è—Ö –ø—Ä–æ–µ–∫—Ç–∞:

### üìä –ê–ù–ê–õ–ò–ó –ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–ô

| –§–∞–π–ª | –§–æ—Ä–º—É–ª–∞ EC | –§–æ—Ä–º—É–ª–∞ NPK | –°—Ç–∞—Ç—É—Å |
|------|------------|-------------|---------|
| `src/business/sensor_compensation_service.cpp` | **–ù–ê–£–ß–ù–ê–Ø:** –ú–æ–¥–µ–ª—å –ê—Ä—á–∏ | **–ù–ê–£–ß–ù–ê–Ø:** FAO 56 | ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ |
| `test/test_compensation_formulas.py` | **–°–¢–ê–†–ê–Ø:** –õ–∏–Ω–µ–π–Ω–∞—è | **–°–¢–ê–†–ê–Ø:** –õ–∏–Ω–µ–π–Ω–∞—è | ‚ùå –£—Å—Ç–∞—Ä–µ–ª–æ |
| `docs/manuals/COMPENSATION_GUIDE.md` | **–ù–ê–£–ß–ù–ê–Ø:** –ú–æ–¥–µ–ª—å –ê—Ä—á–∏ | **–ù–ê–£–ß–ù–ê–Ø:** FAO 56 | ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–æ |

---

## üõ†Ô∏è –†–ï–®–ï–ù–ò–ï

### 1Ô∏è‚É£ **–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –¢–ï–°–¢–û–í**

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –≤ `test/test_compensation_formulas.py`:

#### **EC –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è (–ú–æ–¥–µ–ª—å –ê—Ä—á–∏):**
```python
# –ë–´–õ–û (—Å—Ç–∞—Ä–∞—è —Ñ–æ—Ä–º—É–ª–∞):
temp_factor_ec = 1.0 / (1.0 + 0.02 * (temp - 25.0))

# –°–¢–ê–õ–û (–Ω–∞—É—á–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞):
temp_ratio = temp / 25.0
temp_factor_ec = pow(temp_ratio, n_coeff)  # n = 2.0 –¥–ª—è —Å—É–≥–ª–∏–Ω–∫–∞
humidity_ratio = humidity / field_capacity
humidity_factor_ec = pow(humidity_ratio, m_coeff)  # m = 1.5 –¥–ª—è —Å—É–≥–ª–∏–Ω–∫–∞
ec_compensated = ec_raw * humidity_factor_ec * temp_factor_ec
```

#### **NPK –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è (FAO 56):**
```python
# –ë–´–õ–û (—Å—Ç–∞—Ä–∞—è —Ñ–æ—Ä–º—É–ª–∞):
n_factor = 1.0 - 0.02 * (temp - 25.0)

# –°–¢–ê–õ–û (–Ω–∞—É—á–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞):
temp_factor_n = math.exp(delta_N * (temp - 20.0))  # Œ¥N = 0.0038
moisture_factor_n = 1.0 + (epsilon_N * (humidity - 30.0))  # ŒµN = 0.009
n_corrected = n_raw * temp_factor_n * moisture_factor_n
```

### 2Ô∏è‚É£ **–ù–ê–£–ß–ù–û–ï –û–ë–û–°–ù–û–í–ê–ù–ò–ï**

#### **–ú–æ–¥–µ–ª—å –ê—Ä—á–∏ (1942) –¥–ª—è EC:**
- **–§–æ—Ä–º—É–ª–∞:** `EC_comp = EC_raw √ó (Œ∏/Œ∏‚ÇÄ)^m √ó (T/T‚ÇÄ)^n`
- **–ò—Å—Ç–æ—á–Ω–∏–∫:** Archie, 1942, AAPG Bulletin
- **–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã:** m = 1.5, n = 2.0 –¥–ª—è —Å—É–≥–ª–∏–Ω–∫–∞

#### **FAO 56 –¥–ª—è NPK:**
- **–§–æ—Ä–º—É–ª–∞:** `N_comp = N_raw √ó e^(Œ¥N(T-20)) √ó (1 + ŒµN(Œ∏-30))`
- **–ò—Å—Ç–æ—á–Ω–∏–∫:** Allen et al., 1998, FAO Irrigation Paper 56
- **–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã:** Œ¥N = 0.0038, ŒµN = 0.009 –¥–ª—è —Å—É–≥–ª–∏–Ω–∫–∞

---

## ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢–´

### **–¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç:**
```bash
python -m pytest test/test_compensation_formulas.py -v
======================================== 8 passed in 0.12s =========================================
```

### **–ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä:**
```bash
python scripts/run_simple_tests.py
[SUCCESS] ‚úÖ python_tests: PASS
[SUCCESS] ‚úÖ esp32_build: PASS
[SUCCESS] ‚úÖ formula_consistency: PASS
[SUCCESS] ‚úÖ üéâ –í–°–ï –û–°–ù–û–í–ù–´–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´ –£–°–ü–ï–®–ù–û!
```

### **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—É–ª:**
```bash
python scripts/validate_formula_consistency.py
‚úÖ –í–°–ï –§–û–†–ú–£–õ–´ –°–ò–ù–•–†–û–ù–ò–ó–ò–†–û–í–ê–ù–´!
   ‚Ä¢ EC: –ú–æ–¥–µ–ª—å –ê—Ä—á–∏ (1942)
   ‚Ä¢ pH: –£—Ä–∞–≤–Ω–µ–Ω–∏–µ –ù–µ—Ä–Ω—Å—Ç–∞
   ‚Ä¢ NPK: FAO 56
```

### **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã:**
- ‚úÖ –ö–æ–¥ C++ (–Ω–∞—É—á–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã)
- ‚úÖ –¢–µ—Å—Ç—ã Python (–Ω–∞—É—á–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã)  
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–Ω–∞—É—á–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (–Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç)

---

## üîç –ü–û–ß–ï–ú–£ –≠–¢–û –ü–†–û–ò–°–•–û–î–ò–õ–û

### **–ü—Ä–∏—á–∏–Ω—ã –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π:**

1. **–≠–≤–æ–ª—é—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** –°–Ω–∞—á–∞–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –ø—Ä–æ—Å—Ç—ã–µ –ª–∏–Ω–µ–π–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã
2. **–ù–∞—É—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è:** –ü–æ–∑–∂–µ –≤–Ω–µ–¥—Ä–∏–ª–∏ –Ω–∞—É—á–Ω—ã–µ –º–æ–¥–µ–ª–∏ (–ê—Ä—á–∏, FAO 56)
3. **–ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏–ª–∏ –∫–æ–¥ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, –Ω–æ –∑–∞–±—ã–ª–∏ —Ç–µ—Å—Ç—ã
4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—è:** –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ñ–æ—Ä–º—É–ª

### **–ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å –≤ –±—É–¥—É—â–µ–º:**

1. **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã:** –í—Å–µ —Ñ–æ—Ä–º—É–ª—ã —Ç–æ–ª—å–∫–æ –≤ –∫–æ–¥–µ C++
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è:** –¢–µ—Å—Ç—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–∑ –∫–æ–¥–∞
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
4. **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º—É–ª:** –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## üìã –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:**
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ç–µ—Å—Ç—ã —Å –Ω–∞—É—á–Ω—ã–º–∏ —Ñ–æ—Ä–º—É–ª–∞–º–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ñ–æ—Ä–º—É–ª
- ‚úÖ –í—Å–µ —Ñ–æ—Ä–º—É–ª—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã (—Å—Ç–∞—Ç—É—Å: PASS)

### **–í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è:**
- üîÑ –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ñ–æ—Ä–º—É–ª
- üîÑ –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–æ—Ä–º—É–ª –≤ CI/CD
- üîÑ –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø—Ä–∏–º–µ—Ä—ã –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ:**
- üìä –°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—É—é —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–æ—Ä–º—É–ª–∞–º–∏
- üìä –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤ –∏–∑ –∫–æ–¥–∞
- üìä –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞—É—á–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

---

## üéØ –í–´–í–û–î–´

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞:** –¢–µ–ø–µ—Ä—å –≤—Å–µ —Ñ–æ—Ä–º—É–ª—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–Ω–∞—É—á–Ω–æ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã**.

**–î–æ–≤–µ—Ä–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:** –§–æ—Ä–º—É–ª—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ—Ü–µ–Ω–∑–∏—Ä—É–µ–º—ã–º –Ω–∞—É—á–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –∏ –ø—Ä–æ—à–ª–∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é.

**–ö–∞—á–µ—Å—Ç–≤–æ –ø–æ–≤—ã—à–µ–Ω–æ:** –ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞—É—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤–º–µ—Å—Ç–æ —É–ø—Ä–æ—â–µ–Ω–Ω—ã—Ö –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–π. 