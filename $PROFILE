# JXCT Soil Sensor Project - PowerShell Profile
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å ESP32, PlatformIO –∏ Python

# –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
$Host.UI.RawUI.ForegroundColor = "White"
$Host.UI.RawUI.BackgroundColor = "Black"

# –ê–ª–∏–∞—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–º–∞–Ω–¥–∞–º
Set-Alias -Name pio -Value platformio
Set-Alias -Name py -Value python

# –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JXCT –ø—Ä–æ–µ–∫—Ç–æ–º
function Get-JXCTVersion {
    Write-Host "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ JXCT..." -ForegroundColor Cyan
    if (Test-Path "version.h") {
        $version = Get-Content "version.h" | Select-String "VERSION" | ForEach-Object { $_.ToString().Split('"')[1] }
        Write-Host "üì¶ –í–µ—Ä—Å–∏—è JXCT: $version" -ForegroundColor Green
    } else {
        Write-Host "‚ùå –§–∞–π–ª version.h –Ω–µ –Ω–∞–π–¥–µ–Ω" -ForegroundColor Red
    }
}

function Sync-JXCTVersion {
    Write-Host "üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤–µ—Ä—Å–∏–π..." -ForegroundColor Cyan
    py scripts/sync_versions.py
}

function Test-JXCT {
    Write-Host "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ JXCT..." -ForegroundColor Cyan
    py scripts/run_simple_tests.py
}

function Build-JXCT {
    Write-Host "üî® –°–±–æ—Ä–∫–∞ ESP32..." -ForegroundColor Cyan
    pio run -e esp32dev
}

function Build-JXCT-Prod {
    Write-Host "üè≠ Production —Å–±–æ—Ä–∫–∞ ESP32..." -ForegroundColor Cyan
    pio run -e esp32dev-production
}

function Analyze-JXCT {
    Write-Host "üîç –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞ clang-tidy..." -ForegroundColor Cyan
    py scripts/run_clang_tidy_analysis.py
}

function Test-JXCT-Native {
    Write-Host "üß™ Native —Ç–µ—Å—Ç—ã..." -ForegroundColor Cyan
    pio test -e native
}

function Clean-JXCT {
    Write-Host "üßπ –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞..." -ForegroundColor Cyan
    pio run -t clean
    Remove-Item -Path ".pio" -Recurse -Force -ErrorAction SilentlyContinue
    Write-Host "‚úÖ –ü—Ä–æ–µ–∫—Ç –æ—á–∏—â–µ–Ω" -ForegroundColor Green
}

function Update-JXCT {
    Write-Host "üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..." -ForegroundColor Cyan
    pio update
    py -m pip install --upgrade pytest
}

function Monitor-JXCT {
    Write-Host "üì° –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ESP32..." -ForegroundColor Cyan
    pio device monitor
}

function Flash-JXCT {
    Write-Host "‚ö° –ü—Ä–æ—à–∏–≤–∫–∞ ESP32..." -ForegroundColor Cyan
    pio run -t upload
}

function Flash-JXCT-Monitor {
    Write-Host "‚ö° –ü—Ä–æ—à–∏–≤–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ESP32..." -ForegroundColor Cyan
    pio run -t upload -t monitor
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –ø—Ä–æ–µ–∫—Ç
function cd-JXCT {
    Set-Location "C:\Git\JXCT"
    Write-Host "üìÅ –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø—Ä–æ–µ–∫—Ç JXCT" -ForegroundColor Green
    Get-JXCTVersion
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
function Status-JXCT {
    Write-Host "üìä –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞ JXCT:" -ForegroundColor Cyan
    Write-Host "================================" -ForegroundColor Gray
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ git —Å—Ç–∞—Ç—É—Å–∞
    Write-Host "üîÄ Git —Å—Ç–∞—Ç—É—Å:" -ForegroundColor Yellow
    git status --porcelain | ForEach-Object { Write-Host "  $_" -ForegroundColor White }
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Å–±–æ—Ä–∫–∏
    if (Test-Path ".pio\build\esp32dev\firmware.elf") {
        $size = (Get-Item ".pio\build\esp32dev\firmware.elf").Length
        Write-Host "üì¶ –†–∞–∑–º–µ—Ä –ø—Ä–æ—à–∏–≤–∫–∏: $([math]::Round($size/1MB, 2)) MB" -ForegroundColor Green
    }
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ—Å—Ç–æ–≤
    if (Test-Path "test_reports\simple-test-report.json") {
        Write-Host "‚úÖ –¢–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã" -ForegroundColor Green
    } else {
        Write-Host "‚ö†Ô∏è –¢–µ—Å—Ç—ã –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã" -ForegroundColor Yellow
    }
}

# –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
Write-Host "üöÄ JXCT Environment Loaded!" -ForegroundColor Green
Write-Host "üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:" -ForegroundColor Cyan
Write-Host "  Get-JXCTVersion    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é" -ForegroundColor White
Write-Host "  Sync-JXCTVersion   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏–∏" -ForegroundColor White
Write-Host "  Test-JXCT          - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã" -ForegroundColor White
Write-Host "  Build-JXCT         - –°–æ–±—Ä–∞—Ç—å ESP32" -ForegroundColor White
Write-Host "  Analyze-JXCT       - –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞" -ForegroundColor White
Write-Host "  Clean-JXCT         - –û—á–∏—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç" -ForegroundColor White
Write-Host "  Monitor-JXCT       - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ESP32" -ForegroundColor White
Write-Host "  Flash-JXCT         - –ü—Ä–æ—à–∏—Ç—å ESP32" -ForegroundColor White
Write-Host "  Status-JXCT        - –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞" -ForegroundColor White
Write-Host "  cd-JXCT            - –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ–µ–∫—Ç" -ForegroundColor White 