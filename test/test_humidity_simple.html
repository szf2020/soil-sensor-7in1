<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Простой тест влажности</title>
    <style>
        .green { color: #4CAF50; }
        .yellow { color: #FFC107; }
        .red { color: #F44336; }
        .test-value {
            padding: 10px;
            margin: 5px;
            border: 1px solid #ccc;
            display: inline-block;
            min-width: 100px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Тест окраски влажности</h1>
    <div id="results"></div>
    
    <script>
        // Функция colorSensorRange из нашего кода
        function colorSensorRange(value, sensorType) {
            const ranges = {
                temp: { min: -40, max: 80, precision: '±0.5°C' },
                hum: { min: 0, max: 100, precision: '±3%RH' },
                ph: { min: 3, max: 9, precision: '±0.3pH' },
                ec: { min: 0, max: 20000, precision: '±2-5%' },
                n: { min: 0, max: 1999, precision: '2%' },
                p: { min: 0, max: 1999, precision: '2%' },
                k: { min: 0, max: 1999, precision: '2%' }
            };
            const range = ranges[sensorType];
            if (!range) return '';
            if (value < range.min || value > range.max) return 'red';
            // ОСОБАЯ ЛОГИКА ДЛЯ ВЛАЖНОСТИ: желтый выше 53%
            if (sensorType === 'hum' && value > 53) return 'yellow';
            return 'green'; // В рабочем диапазоне - зеленый
        }
        
        // Функция setRawWithPrecision из нашего кода
        function setRawWithPrecision(id, value, sensorType) {
            const ranges = {
                temp: { precision: '±0.5°C' },
                hum: { precision: '±3%RH', lowPrecisionMin: 53, lowPrecisionMax: 100, lowPrecision: '±5%RH' },
                ph: { precision: '±0.3pH' },
                ec: { precision: '±2-5%' },
                n: { precision: '2%' },
                p: { precision: '2%' },
                k: { precision: '2%' }
            };
            const range = ranges[sensorType];
            if (!range) {
                return value;
            }
            let precision = range.precision;
            // ОСОБАЯ ЛОГИКА ДЛЯ ВЛАЖНОСТИ: показываем ±5%RH выше 53%
            if (sensorType === 'hum' && value > 53 && range.lowPrecision) {
                precision = range.lowPrecision;
            }
            return value + ' (' + precision + ')';
        }
        
        // Тестируем различные значения влажности
        const testValues = [0, 25, 50, 53, 54, 60, 80, 100, 105];
        
        let resultsHtml = '<h2>Тест значений влажности:</h2>';
        
        testValues.forEach((value, index) => {
            const color = colorSensorRange(value, 'hum');
            const displayValue = setRawWithPrecision('test', value, 'hum');
            
            resultsHtml += `
                <div class="test-value ${color}" id="hum-test-${index}">
                    ${displayValue} → ${color}
                </div>
            `;
        });
        
        document.getElementById('results').innerHTML = resultsHtml;
        
        console.log('=== ТЕСТ ЛОГИКИ ===');
        testValues.forEach(value => {
            const color = colorSensorRange(value, 'hum');
            const displayValue = setRawWithPrecision('test', value, 'hum');
            console.log(`Влажность ${value}% → ${displayValue} → цвет: ${color}`);
        });
    </script>
</body>
</html> 